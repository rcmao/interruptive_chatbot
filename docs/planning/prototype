┌─────────────────────────────────────────────────────────────────────────────┐
│                        Discord打断型Chatbot系统架构                          │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   用户A: 张三    │    │   用户B: 李四    │    │   用户C: 王五    │
│   "这个方案不行"  │    │   "你懂什么?"    │    │   "别吵了..."   │
└─────────┬───────┘    └─────────┬───────┘    └─────────┬───────┘
          │                      │                      │
          ▼                      ▼                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Discord频道                                        │
│  💬 张三: "这个AI方案根本不可行，浪费时间"                                    │
│  💬 李四: "你根本不懂AI，别瞎说"                                             │
│  💬 张三: "我做了5年开发，你才工作1年"                                        │
│  💬 李四: "经验不等于对新技术的理解"                                          │
│  🤖 Bot: "我注意到大家对AI方案有不同看法，让我们..."                          │
└─────────────────────────┬───────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        Bot消息处理流程                                       │
│                                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐  │
│  │   消息监听   │───▶│  历史存储    │───▶│  冲突检测    │───▶│  干预决策    │  │
│  │ on_message() │    │ deque(10)   │    │ GPT-4分析   │    │ 阈值判断     │  │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘  │
│                                                │                           │
│                                                ▼                           │
│                                        ┌─────────────┐                     │
│                                        │ 冲突评分系统 │                     │
│                                        │ 1-10分评级  │                     │
│                                        │ 情绪指标分析 │                     │
│                                        └─────────────┘                     │
└─────────────────────────────────────────────┬───────────────────────────────┘
                                              │
                                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         TKI策略选择器                                        │
│                                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                     │
│  │ Accommodating│    │Collaborating│    │ Compromising│                     │
│  │   迁就型     │    │   协作型     │    │   妥协型     │                     │
│  │ 验证观点     │    │ 整合方案     │    │ 寻求中间点   │                     │
│  │ 降低冲突     │    │ 创新解决     │    │ 平衡利益     │                     │
│  └─────────────┘    └─────────────┘    └─────────────┘                     │
│                                │                                           │
│                                ▼                                           │
│                        ┌─────────────┐                                     │
│                        │ 策略选择逻辑 │                                     │
│                        │ 基于冲突类型 │                                     │
│                        │ 和严重程度   │                                     │
│                        └─────────────┘                                     │
└─────────────────────────────────────────────┬───────────────────────────────┘
                                              │
                                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        GPT-4回复生成                                         │
│                                                                             │
│  输入Prompt:                                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 你是一个调解员，使用Accommodating策略:                                │   │
│  │ - 验证所有观点                                                      │   │
│  │ - 承认情绪                                                          │   │
│  │ - 寻找共同点                                                        │   │
│  │ - 降低紧张                                                          │   │
│  │                                                                     │   │
│  │ 对话历史: [最近4条消息]                                             │   │
│  │ 生成一个缓和、验证性的回复                                          │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  输出示例:                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 🤖 我注意到大家对AI方案有不同的专业见解。张三，你的5年开发经验       │   │
│  │ 确实很宝贵，对项目风险的担忧很有道理。李四，你对新技术的理解也很    │   │
│  │ 深入。也许我们可以结合两种视角：用张三的经验来评估风险，用李四的    │   │
│  │ 新技术知识来优化方案？这样既稳妥又创新。                            │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────┬───────────────────────────────┘
                                              │
                                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          效果监控                                           │
│                                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                     │
│  │ 对话质量评估 │    │ 冲突缓解程度 │    │ 用户满意度   │                     │
│  │ 建设性程度   │    │ 情绪平稳度   │    │ 接受度调查   │                     │
│  │ 参与度变化   │    │ 攻击性减少   │    │ 干预时机评价 │                     │
│  └─────────────┘    └─────────────┘    └─────────────┘                     │
│                                                                             │
│  实时指标:                                                                  │
│  • 干预次数/小时                                                           │
│  • 干预后冲突平息率                                                         │
│  • 用户继续对话率                                                           │
│  • 策略有效性分布                                                           │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                          技术栈总览                                          │
│                                                                             │
│  前端: Discord客户端 (用户界面)                                             │
│  中间件: discord.py (消息处理)                                              │
│  AI引擎: OpenAI GPT-4 API (冲突检测 + 回复生成)                            │
│  数据存储: 内存deque (消息历史)                                             │
│  部署: Python脚本 + Discord Bot Token                                      │
│                                                                             │
│  关键特性:                                                                  │
│  ✅ 零样本学习 (无需训练数据)                                               │
│  ✅ 实时检测 (消息级别监控)                                                 │
│  ✅ 多策略干预 (TKI框架)                                                    │
│  ✅ 自然语言处理 (GPT-4驱动)                                               │
└─────────────────────────────────────────────────────────────────────────────┘